<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head profile="http://gmpg.org/xfn/11">
	<title>Syntactic Bay Leaves - Tokyo Tyrant: The magic little database</title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<link rel="stylesheet" type="text/css" media="screen,projection" href="/wp-content/themes/blogtxt/style.css" title="blog.txt" />
	<link rel="stylesheet" type="text/css" media="print" href="/wp-content/themes/blogtxt/print.css" />
	<link rel="alternate" type="application/rss+xml" href="/feed/" title="Syntactic Bay Leaves RSS feed" />
	<link rel="alternate" type="application/rss+xml" href="/comments/feed/" title="Syntactic Bay Leaves comments RSS feed" />
	<link rel="pingback" href="/xmlrpc.php" />

<link rel="alternate" type="application/rss+xml" title="Syntactic Bay Leaves &raquo; Tokyo Tyrant: The magic little database Comments Feed" href="/2009/08/15/tokyo-tyrant-the-magic-little-database/feed/" />
<link rel='stylesheet' id='openid-css'  href='/wp-content/plugins/openid/f/openid.css?ver=519' type='text/css' media='all' />
<script type='text/javascript' src='/wp-includes/js/jquery/jquery.js?ver=1.4.2'></script>
<script type='text/javascript' src='/wp-content/plugins/openid/f/openid.js?ver=519'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='Syntactic Bay Leaves' href='/' />
<link rel='start' title='Getting Involved with SproutCore' href='/2008/07/24/getting-involved-with-sproutcore/' />
<link rel='prev' title='Erliki &#8211; a wiki written in Erlang' href='/2009/08/10/erliki-a-wiki-written-in-erlang/' />
<link rel='next' title='Big Mac Math' href='/2009/08/21/big-mac-math/' />
<meta name="generator" content="WordPress 3.0.1" />
<link rel='canonical' href='/2009/08/15/tokyo-tyrant-the-magic-little-database/' />
<link rel='shortlink' href='/?p=77' />

<link rel="stylesheet" href="/wp-content/plugins/wp-syntax/wp-syntax.css" type="text/css" media="screen" />
	<link rel="stylesheet" type="text/css" media="screen,projection" href="/wp-content/themes/blogtxt/layouts/2c-r.css" />

<style type="text/css" media="screen,projection">
/*<![CDATA[*/
/* CSS inserted by blog.txt theme options */
	body{font-size:100%;}
	body,div.comments h3.comment-header span.comment-count,div.entry-content ul.xoxo li.hentry span.entry-title{font-family:tahoma,geneva,sans-serif;}
	div#wrapper{width:60em;}
	div.hfeed .entry-title,div.hfeed .page-title,div.comments h3,div.entry-content h2,div.entry-content h3,div.entry-content h4,div.entry-content h5,div.entry-content h6,div#header div#blog-description,div#header div.archive-description{font-family:tahoma,geneva,sans-serif;}
	div#header h1#blog-title,div.sidebar ul li h3{font-family:tahoma,geneva,sans-serif;}
	body input#s,div.entry-content div.page-link,div.entry-content p.attachment-name,div.entry-content q,div.comments ol.commentlist q,div.formcontainer div.form-input input,div.formcontainer div.form-textarea textarea,div.hentry div.entry-meta,div.sidebar{font-family:tahoma,geneva,sans-serif;}
	div.hfeed div.hentry{text-align:left;}
	body div#wrapper{margin:5em auto 0 auto;padding:0 1em;}
/*]]>*/
</style>

</head>

<body class="wordpress y2010 m08 d11 h01 single s-y2009 s-m08 s-d15 s-h02 s-category-database s-category-python s-author-admin">

<div id="wrapper">
	<div id="container">
		<div id="content">

			<div id="header">
				<h1 id="blog-title"><a href="/" title="Syntactic Bay Leaves">Syntactic Bay Leaves</a></h1>
				<div id="blog-description">Pungent programming, by Carlo Cabanilla</div>
			</div><!-- #header -->
	
			<div class="access"><span class="content-access"><a href="#content" title="Skip to content">Skip to content</a></span></div>

			<div id="globalnav"><ul id="menu"><li class="page_item_home home-link"><a href="/" title="Syntactic Bay Leaves" rel="home">Home</a></li><li class="page_item page-item-2"><a href="/about/" title="About">About</a></li></ul></div>

			<div class="hfeed">


				<div id="post-77" class="hentry p1 post publish author-admin category-database category-python y2009 m08 d15 h02">
					<h2 class="entry-title">Tokyo Tyrant: The magic little database</h2>
					<div class="entry-content">
<p>I&#8217;ve been playing around with <a href="http://tokyocabinet.sourceforge.net/tyrantdoc/" onclick="javascript:pageTracker._trackPageview('/outbound/article/tokyocabinet.sourceforge.net');">Tokyo Tyrant</a> master-master replication and I have got to say that it is a magical little database. Here&#8217;s some sample code to configure two Tokyo Tyrant instances in master-master replication mode, as well as a script to show off some of Tyrant&#8217;s capabilities, including memcached protocol support.</p>

<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">#!/bin/bash</span>
&nbsp;
<span style="color: #007800;">HOST</span>=127.0.0.1
<span style="color: #007800;">PORT</span>=<span style="color: #000000;">1978</span>
<span style="color: #007800;">SID</span>=<span style="color: #000000;">1</span>
<span style="color: #007800;">UPDATE_LOG_DIR</span>=ulog<span style="color: #000000; font-weight: bold;">/</span><span style="color: #007800;">$SID</span>
<span style="color: #007800;">MASTER_HOST</span>=127.0.0.1
<span style="color: #007800;">MASTER_PORT</span>=<span style="color: #000000;">1979</span>
&nbsp;
<span style="color: #c20cb9; font-weight: bold;">mkdir</span> <span style="color: #660033;">-p</span> <span style="color: #007800;">$UPDATE_LOG_DIR</span>
&nbsp;
ttserver <span style="color: #660033;">-host</span> <span style="color: #007800;">$HOST</span> \
         <span style="color: #660033;">-port</span> <span style="color: #007800;">$PORT</span> \
         <span style="color: #660033;">-ulog</span> <span style="color: #007800;">$UPDATE_LOG_DIR</span> \
         <span style="color: #660033;">-sid</span> <span style="color: #007800;">$SID</span> \
         <span style="color: #660033;">-mhost</span> <span style="color: #007800;">$MASTER_HOST</span> \
         <span style="color: #660033;">-mport</span> <span style="color: #007800;">$MASTER_PORT</span></pre></div></div>


<div class="wp_syntax"><div class="code"><pre class="bash" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">#!/bin/bash</span>
&nbsp;
<span style="color: #007800;">HOST</span>=127.0.0.1
<span style="color: #007800;">PORT</span>=<span style="color: #000000;">1979</span>
<span style="color: #007800;">SID</span>=<span style="color: #000000;">2</span>
<span style="color: #007800;">UPDATE_LOG_DIR</span>=ulog<span style="color: #000000; font-weight: bold;">/</span><span style="color: #007800;">$SID</span>
<span style="color: #007800;">MASTER_HOST</span>=127.0.0.1
<span style="color: #007800;">MASTER_PORT</span>=<span style="color: #000000;">1978</span>
&nbsp;
<span style="color: #c20cb9; font-weight: bold;">mkdir</span> <span style="color: #660033;">-p</span> <span style="color: #007800;">$UPDATE_LOG_DIR</span>
&nbsp;
ttserver <span style="color: #660033;">-host</span> <span style="color: #007800;">$HOST</span> \
         <span style="color: #660033;">-port</span> <span style="color: #007800;">$PORT</span> \
         <span style="color: #660033;">-ulog</span> <span style="color: #007800;">$UPDATE_LOG_DIR</span> \
         <span style="color: #660033;">-sid</span> <span style="color: #007800;">$SID</span> \
         <span style="color: #660033;">-mhost</span> <span style="color: #007800;">$MASTER_HOST</span> \
         <span style="color: #660033;">-mport</span> <span style="color: #007800;">$MASTER_PORT</span></pre></div></div>


<div class="wp_syntax"><div class="code"><pre class="python" style="font-family:monospace;"><span style="color: #ff7700;font-weight:bold;">import</span> pytyrant
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">time</span>
&nbsp;
t1 = pytyrant.<span style="color: black;">PyTyrant</span>.<span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'127.0.0.1'</span>, <span style="color: #ff4500;">1978</span><span style="color: black;">&#41;</span>
t2 = pytyrant.<span style="color: black;">PyTyrant</span>.<span style="color: #008000;">open</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'127.0.0.1'</span>, <span style="color: #ff4500;">1979</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">print</span> t2.<span style="color: black;">get</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'foo'</span>, <span style="color: #483d8b;">'nothing here'</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># 'nothing here'</span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Writing to t1 replicates to t2</span>
t1<span style="color: black;">&#91;</span><span style="color: #483d8b;">'foo'</span><span style="color: black;">&#93;</span> = <span style="color: #483d8b;">'bar'</span>
<span style="color: #ff7700;font-weight:bold;">print</span> t2.<span style="color: black;">get</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'foo'</span>, <span style="color: #483d8b;">'nothing here'</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># 'foo'</span>
&nbsp;
&nbsp;
<span style="color: #808080; font-style: italic;"># Tokyo Tyrant also speaks the memcached protocol </span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">import</span> memcache
mc = memcache.<span style="color: black;">Client</span><span style="color: black;">&#40;</span><span style="color: black;">&#91;</span><span style="color: #483d8b;">'127.0.0.1:1978'</span>, <span style="color: #483d8b;">'127.0.0.1:1979'</span><span style="color: black;">&#93;</span><span style="color: black;">&#41;</span>
&nbsp;
<span style="color: #ff7700;font-weight:bold;">print</span> mc.<span style="color: black;">get</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'foo'</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># 'bar'</span>
mc.<span style="color: #008000;">set</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'yo'</span>, <span style="color: #483d8b;">'sup'</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># Assigns ('yo', 'sup') pair to one of the servers in the pool </span>
&nbsp;
<span style="color: #808080; font-style: italic;"># Both Tyrant servers should have ('yo', 'sup') because of master-master replication </span>
<span style="color: #ff7700;font-weight:bold;">print</span> t1.<span style="color: black;">get</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'yo'</span>, <span style="color: #483d8b;">'nothing in t1'</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># 'sup'</span>
<span style="color: #ff7700;font-weight:bold;">print</span> t2.<span style="color: black;">get</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'yo'</span>, <span style="color: #483d8b;">'nothing in t2'</span><span style="color: black;">&#41;</span> <span style="color: #808080; font-style: italic;"># 'sup'</span></pre></div></div>

<p>For more on Tokyo Tyrant and Tokyo Cabinet, check out this slideshow:</p>
<div style="width:425px;text-align:left" id="__ss_1125322"><a style="font:14px Helvetica,Arial,Sans-serif;display:block;margin:12px 0 3px 0;text-decoration:underline;" href="http://www.slideshare.net/estraier/introduction-to-tokyo-products" onclick="javascript:pageTracker._trackPageview('/outbound/article/www.slideshare.net');" title="Introduction to Tokyo Products">Introduction to Tokyo Products</a><object style="margin:0px" width="425" height="355"><param name="movie" value="http://static.slidesharecdn.com/swf/ssplayer2.swf?doc=tokyoproducts-090310033450-phpapp01&#038;rel=0&#038;stripped_title=introduction-to-tokyo-products" /><param name="allowFullScreen" value="true"/><param name="allowScriptAccess" value="always"/><embed src="http://static.slidesharecdn.com/swf/ssplayer2.swf?doc=tokyoproducts-090310033450-phpapp01&#038;rel=0&#038;stripped_title=introduction-to-tokyo-products" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="425" height="355"></embed></object>
<div style="font-size:11px;font-family:tahoma,arial;height:26px;padding-top:2px;">View more <a style="text-decoration:underline;" href="http://www.slideshare.net/" onclick="javascript:pageTracker._trackPageview('/outbound/article/www.slideshare.net');">documents</a> from <a style="text-decoration:underline;" href="http://www.slideshare.net/estraier" onclick="javascript:pageTracker._trackPageview('/outbound/article/www.slideshare.net');">Mikio Hirabayashi</a>.</div>
</div>


					</div>

<!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="/2009/08/15/tokyo-tyrant-the-magic-little-database/"
    dc:identifier="/2009/08/15/tokyo-tyrant-the-magic-little-database/"
    dc:title="Tokyo Tyrant: The magic little database"
    trackback:ping="/2009/08/15/tokyo-tyrant-the-magic-little-database/trackback/" />
</rdf:RDF> -->

<script type="text/javascript"><!--
google_ad_client = "pub-6369205852477839";
/* 468x60, created 2/10/10 */
google_ad_slot = "4624827275";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>

				</div><!-- .post -->

<div class="comments">


</div><!-- .comments -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous">&laquo; <a href="/2009/08/10/erliki-a-wiki-written-in-erlang/" rel="prev">Erliki &#8211; a wiki written in Erlang</a></div>
					<div class="nav-next"><a href="/2009/08/21/big-mac-math/" rel="next">Big Mac Math</a> &raquo;</div>
				</div>

			</div><!-- .hfeed -->
		</div><!-- #content -->
	</div><!-- #container -->

	<div id="primary" class="sidebar">
		<ul>
			<li id="home-link">
				<h3><a href="http://syntacticbayleaves.com" title="Syntactic Bay Leaves">&laquo; Home</a></h3>
			</li>
			<li class="entry-meta">
				<h3>About This Post</h3>
				<ul>
					<li>Written by <span class="entry-author author vcard"><a class="url fn" href="/author/admin/" title="View all posts by Carlo">Carlo</a></span></li>
					<li><abbr class="published" title="2009-08-15T14:55:13+0000">August 15th, 2009 at 2:55 pm</abbr></li>
									</ul>
			</li>
			<li class="entry-category">
				<h3>Categories</h3>
				<ul>
					<li><a href="/category/database/" title="View all posts in Database" rel="category tag">Database</a></li><li><a href="/category/programming/python/" title="View all posts in Python" rel="category tag">Python</a></li>
				</ul>
			</li>
			<li class="entry-tags">
				<h3>Tags</h3>
				<ul>
					<li><a href="/tag/tokyo-tyrant/" rel="tag">Tokyo Tyrant</a></li>				</ul>
			</li>
		</ul>
	</div><!-- single.php #primary .sidebar -->


	<div id="footer">
		<span id="theme-link"><a href="http://www.plaintxt.org/themes/blogtxt/" title="blog.txt theme for WordPress" rel="follow designer">blog.txt</a> theme by <span class="vcard"><a class="url fn n" href="http://scottwallick.com/" title="scottwallick.com" rel="follow designer"><span class="given-name">Scott</span><span class="additional-name"> Allan</span><span class="family-name"> Wallick</span></a></span></span>
	</div><!-- #footer -->

</div><!-- #wrapper -->


<!-- Google Analytics for WordPress | http://yoast.com/wordpress/google-analytics/ -->
<script type="text/javascript">
	var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
	document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
	try {
		var pageTracker = _gat._getTracker("UA-4116300-1");
		// Cookied already: 
		pageTracker._trackPageview();
	} catch(err) {}
</script>
<!-- End of Google Analytics code -->

</body><!-- end transmission -->
</html>
<!-- Dynamic page generated in 1.044 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2010-08-11 01:28:59 -->
<!-- super cache -->